<!DOCTYPE html>
{% extends 'social/base.html' %}
<head>
  {% load static %}
  {% load tags %}
  {% block stylesheet %}{% endblock %}
<script src="{% static 'social/basescript.js' %}"></script>

<body>
  <main>
    <li class="post" id="post{{ post.pk }}">
      <!-- Post text and image -->
      <p class="post-text" id="post_text{{ post.pk }}">{{ post.post_text }}</p>
      {% if post.image %}
        <img class="img-fluid" src="{{ post.image.url }}" alt="post-image-{{ post.pk }}">
      {% endif %}
      <!-- Post header -->
      <div class="post-header">
        <a href="{% url 'social:user' post.user.pk %}">{{ post.user.username }}</a> 
        <span class="post-date">{{ post.get_readable_date }}</span>
        {% if post.user == user %}
        <img class="icon" src="{% static 'icons/pencil-alt.svg' %}" onclick="toggleVisibility('edit{{ post.pk }}');">
        <img class="icon" alt="delete" src="{% static 'icons/trash-alt.svg' %}" onclick="toggleVisibility('delete{{ post.pk }}');">
        <!-- Options -->
        <span class="none" id="edit{{ post.pk }}">
          <form onsubmit="editPost('{{ post.pk }}')">
            <input type="text" name="new_text" placeholder="Edit your post" id="edit-field" maxlength="200" minlength="1" value="{{ post.post_text }}" required="">
            {{ editform.id.as_hidden }}
            <button class="btn btn-primary" type="submit">Edit</button>
          </form>
        </span>
        <span class="none" id="delete{{ post.pk }}">Delete the post?<button class="btn btn-danger" onclick="deletePost({{ post.pk }})">Yes, delete it.</button></span>
      {% endif %}
      <!-- Likes and dislikes -->
      <span style="text-align: left;">
        <button class="btn btn-outline-success btn-sm" onclick="like({{ post.pk }})">
          <img class="icon" src="{% static 'icons/thumbs-up.svg' %}">
          <span id="total_likes{{ post.pk }}">{% total_likes post %}</span>
        </button>
        <button class="btn btn-outline-secondary btn-sm" onclick="dislike({{ post.pk }})">
          <img class="icon" src="{% static 'icons/thumbs-down.svg' %}">
          <span id="total_dislikes{{ post.pk }}">{% total_dislikes post %}</span>
        </button>
      </span>
      </div>
      <!-- Hidden comment form -->
      <span id="comment_in_reply{{ post.pk }}">
        <form onsubmit="commentInReply({{ post.pk }})">
          {{ commentform }}
          <button class="btn btn-primary btn-block" type="submit">Comment</button>
        </form>
      </span>
      <!-- Comment section -->
      <ul id="comment_section{{ post.pk }}">
        <span class="none" id="currentcomment">{{ post.comment_set.all.last.pk }}</span>
        {% for comment in post.comment_set.all %}
        <br>
        <li class="{% if comment.in_reply_to_comment %}inreply{% else %}comment{% endif %} comment-text"  id="comment{{ comment.pk }}">
          <!-- Comment header -->
          <div style="margin-left:15px;">
            <div>
              <span>
                <a href="{% url 'social:user' comment.posted_by.pk %}">{{ comment.posted_by }}</a>
                {% if comment.in_reply_to_comment %}
                in reply to 
                <a href="{% url 'social:user' comment.in_reply_to_user %}">{{ comment.get_user }}</a>'s
                <a href="{% url 'social:showcomment' comment.in_reply_to_comment %}">comment</a>
                {% endif %}
              </span>
              <span class="post-date">{{ comment.get_readable_date }}</span>
              <!-- Options-->
              <span>

                <img class="icon" alt="reply" src="{% static 'icons/arrow-down.svg' %}" onclick="toggleVisibility('comment_in_reply{{ comment.pk }}');">
                {% if comment.posted_by == user %}
                <img class="icon" src="{% static 'icons/pencil-alt.svg' %}" onclick="toggleVisibility('edit_comment{{   comment.pk }}');">
                <img class="icon" alt="delete" src="{% static 'icons/trash-alt.svg' %}" onclick="toggleVisibility ('delete_comment{{ comment.pk }}');">

                <span class="none" id="delete_comment{{ comment.pk }}">Delete the comment?<button class="btn btn-danger"  onclick="deleteComment({{ comment.pk }})">Yes, delete it.</button></span>

                <span class="none" id="edit_comment{{ comment.pk }}">
                  <form onsubmit="editComment({{ comment.pk }})">
                    <input type="text" name="new_text" placeholder="Edit here" id="edit-field" maxlength="200"  minlength="1" value="{{ comment }}" required="">
                    {{ editform.id.as_hidden }}
                    <button class="btn btn-primary" type="submit">Edit comment</button>
                  </form>
                </span>
              </span>
              {% endif %}          
            </div>

            <p class="comment-text" id="comment_text{{ comment.pk }}">{{ comment }}</p>

           <span class="none" id="comment_in_reply{{ comment.pk }}">
             <form onsubmit="commentInReply({{ post.pk }}, {{ comment.pk }})">
               {{ commentform }}
               <input type="hidden" id="in_reply_to_user{{ comment.pk }}" value="{{ comment.posted_by.pk }}">
                <input type="hidden" id="in_reply_to_comment{{ comment.pk }}" value="{{ comment.pk }}">
                <button class="btn btn-primary btn-block" type="submit">Reply</button>
             </form>
           </span>
         </div>
       </li>
       {% endfor %} <!-- end of the comment list -->
      </ul>
    <div style="border-bottom: 1px #0069d9 solid; margin-top: 5%;"></div>
    </li>
  </main>
</body>